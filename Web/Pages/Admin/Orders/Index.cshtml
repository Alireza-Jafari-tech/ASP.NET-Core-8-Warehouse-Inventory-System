@page
@model Web.Pages.Admin.Orders.IndexModel

@{

}

<style>
    .order-status-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.35rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.3px;
    text-transform: uppercase;
    border: 1px solid transparent;
}

/* Pending - Yellow/Amber */
.order-status-pending {
    background-color: #fef3c7;
    color: #92400e;
    border-color: #fde68a;
}

/* Confirmed - Blue */
.order-status-confirmed {
    background-color: #dbeafe;
    color: #1e40af;
    border-color: #93c5fd;
}

/* Processing - Purple */
.order-status-processing {
    background-color: #e9d5ff;
    color: #6b21a8;
    border-color: #c084fc;
}

/* Shipped - Indigo */
.order-status-shipped {
    background-color: #c7d2fe;
    color: #3730a3;
    border-color: #818cf8;
}

/* Delivered - Green */
.order-status-delivered {
    background-color: #d1fae5;
    color: #065f46;
    border-color: #6ee7b7;
}

/* Cancelled - Red */
.order-status-cancelled {
    background-color: #fee2e2;
    color: #991b1b;
    border-color: #fca5a5;
}

/* On Hold - Gray */
.order-status-onhold {
    background-color: #f3f4f6;
    color: #4b5563;
    border-color: #d1d5db;
}

/* Refunded - Orange */
.order-status-refunded {
    background-color: #ffedd5;
    color: #9a3412;
    border-color: #fdba74;
}
</style>

<div class="content">
    <div class="page-header">
        <h1 class="page-title">Orders</h1>
    </div>

    <div class="table-container">
        <div class="table-header">
            <h2 class="table-title">All Orders</h2>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Order Id</th>
                    <th>Company Name</th>
                    <th>Submit Date</th>
                    <th>Confirm Date</th>
                    <th>Status</th>
                    <th>View Order</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.Orders != null && Model.Orders.Any())
                {
                    foreach (var order in Model.Orders)
                    {
                        <tr>
                            <td>@order.Id</td>
                            <td>@order.CompanyName</td>
                            <td>@order?.OrderSubmittedDate</td>
                            <td>
                                @((order.OrderConfirmedDate == null)
                                ? "--"
                                : order.OrderConfirmedDate)
                            </td>
                            <td>
                                <span class="status-badge @order.OrderStatus.CssClassName">@order.OrderStatus.Name</span>
                            </td>
                            <td>
                                <a
                                asp-page="/Admin/Orders/ViewOrder"
                                asp-route-id="@order.Id"
                                class="btn btn-outline btn-sm view-order-btn">
                                    <i class="fas fa-eye"></i> View
                                </a>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>

<!-- Modals -->
    
    <!-- Order Details Modal -->
    <div class="modal" id="orderDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Order Details</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="order-details">
                    <div>
                        <div class="detail-group">
                            <div class="detail-label">Order Number</div>
                            <div class="detail-value" id="detail-order-number">ORD-001</div>
                        </div>
                        <div class="detail-group">
                            <div class="detail-label">Customer</div>
                            <div class="detail-value" id="detail-customer">ABC Corp</div>
                        </div>
                        <div class="detail-group">
                            <div class="detail-label">Order Date</div>
                            <div class="detail-value" id="detail-date">2023-10-15</div>
                        </div>
                        <div class="detail-group">
                            <div class="detail-label">Status</div>
                            <div class="detail-value">
                                <span class="status-badge status-delivered" id="detail-status">Delivered</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="detail-group">
                            <div class="detail-label">Item</div>
                            <div class="detail-value" id="detail-item">Widget A</div>
                        </div>
                        <div class="detail-group">
                            <div class="detail-label">Quantity</div>
                            <div class="detail-value" id="detail-quantity">25</div>
                        </div>
                        <div class="detail-group">
                            <div class="detail-label">Unit Price</div>
                            <div class="detail-value" id="detail-price">$24.99</div>
                        </div>
                        <div class="detail-group">
                            <div class="detail-label">Total Amount</div>
                            <div class="detail-value" id="detail-total">$624.75</div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Order Description</label>
                    <textarea class="form-control" id="detail-description" rows="4" readonly>Standard priority shipping requested. Customer reference: Project Alpha</textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline close-modal">Close</button>
                <button class="btn btn-primary">Print Invoice</button>
            </div>
        </div>
    </div>

    <!-- Create Order Modal -->
    <div class="modal" id="createOrderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create New Order</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Customer</label>
                    <select class="form-control" id="orderCustomer">
                        <option>Select Customer</option>
                        <option>ABC Corp</option>
                        <option>XYZ Ltd</option>
                        <option>Tech Solutions</option>
                        <option>Manufacturing Inc</option>
                        <option>Retail Partners</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Item</label>
                    <select class="form-control" id="orderItem">
                        <option>Select Item</option>
                        <option>Widget A</option>
                        <option>Component B</option>
                        <option>Tool C</option>
                        <option>Material D</option>
                        <option>Part E</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Quantity</label>
                    <input type="number" class="form-control" id="orderQuantity" min="1" value="1">
                </div>
                <div class="form-group">
                    <label class="form-label">Unit Price</label>
                    <input type="number" class="form-control" id="orderPrice" step="0.01" min="0.01" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label class="form-label">Order Date</label>
                    <input type="date" class="form-control" id="orderDate">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-control" id="orderDescription" rows="4" placeholder="Order description, special instructions, etc."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Initial Status</label>
                    <select class="form-control" id="orderStatus">
                        <option value="pending">Pending</option>
                        <option value="processing">Processing</option>
                        <option value="shipped">Shipped</option>
                        <option value="delivered">Delivered</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline close-modal">Cancel</button>
                <button class="btn btn-primary" id="saveOrderBtn">Create Order</button>
            </div>
        </div>
    </div>

    <!-- Delete Order Modal -->
    <div class="modal" id="deleteOrderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Confirm Delete</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this order? This action cannot be undone.</p>
                <p><strong id="deleteOrderNumber"></strong></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline close-modal">Cancel</button>
                <button class="btn btn-danger" id="confirmDeleteOrderBtn">Delete Order</button>
            </div>
        </div>
    </div>

<script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date for new orders
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('orderDate').value = today;
            
            // Modal elements
            const orderDetailsModal = document.getElementById('orderDetailsModal');
            const createOrderModal = document.getElementById('createOrderModal');
            const deleteOrderModal = document.getElementById('deleteOrderModal');
            
            // Buttons
            const saveOrderBtn = document.getElementById('saveOrderBtn');
            const confirmDeleteOrderBtn = document.getElementById('confirmDeleteOrderBtn');
            
            // Delete order details
            const deleteOrderNumber = document.getElementById('deleteOrderNumber');
            
            // Variables for current order
            let currentOrderId = null;
            
            // View order details (edit button)
            document.querySelectorAll('.action-btn.edit').forEach(btn => {
                btn.addEventListener('click', function() {
                    currentOrderId = this.getAttribute('data-id');
                    const row = this.closest('tr');
                    const cells = row.querySelectorAll('td');
                    
                    // Fill order details
                    document.getElementById('detail-order-number').textContent = cells[0].textContent;
                    document.getElementById('detail-customer').textContent = cells[1].textContent;
                    document.getElementById('detail-item').textContent = cells[2].textContent;
                    document.getElementById('detail-quantity').textContent = cells[3].textContent;
                    document.getElementById('detail-date').textContent = cells[4].textContent;
                    
                    // Get status badge text
                    const statusBadge = cells[5].querySelector('.status-badge');
                    document.getElementById('detail-status').textContent = statusBadge.textContent;
                    
                    orderDetailsModal.classList.add('active');
                });
            });
            
            // Delete order
            document.querySelectorAll('.action-btn.delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    currentOrderId = this.getAttribute('data-id');
                    const row = this.closest('tr');
                    const orderNumber = row.querySelector('td').textContent;
                    deleteOrderNumber.textContent = orderNumber;
                    deleteOrderModal.classList.add('active');
                });
            });
            
            // Update status buttons
            document.querySelectorAll('.update-status-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const orderId = this.getAttribute('data-order');
                    const statusContainer = document.getElementById(`status-container-${orderId}`);
                    
                    // Hide all other status update containers
                    document.querySelectorAll('.status-update-container').forEach(container => {
                        if (container.id !== `status-container-${orderId}`) {
                            container.classList.remove('active');
                        }
                    });
                    
                    // Toggle current container
                    statusContainer.classList.toggle('active');
                    
                    // If showing, set current status in select
                    if (statusContainer.classList.contains('active')) {
                        const currentStatus = statusContainer.previousElementSibling.textContent.trim().toLowerCase();
                        const select = statusContainer.querySelector('select');
                        select.value = currentStatus;
                    }
                });
            });
            
            // Save status buttons
            document.querySelectorAll('.save-status').forEach(btn => {
                btn.addEventListener('click', function() {
                    const orderId = this.getAttribute('data-order');
                    const statusContainer = document.getElementById(`status-container-${orderId}`);
                    const select = statusContainer.querySelector('select');
                    const newStatus = select.value;
                    const statusBadge = statusContainer.previousElementSibling;
                    
                    // Update badge text and class
                    const statusText = newStatus.charAt(0).toUpperCase() + newStatus.slice(1);
                    statusBadge.textContent = statusText;
                    statusBadge.className = `status-badge status-${newStatus}`;
                    
                    // Hide update container
                    statusContainer.classList.remove('active');
                    
                    alert(`Order ${orderId} status updated to ${statusText}`);
                });
            });
            
            // Save new order
            saveOrderBtn.addEventListener('click', () => {
                const customer = document.getElementById('orderCustomer').value;
                const item = document.getElementById('orderItem').value;
                const quantity = document.getElementById('orderQuantity').value;
                
                if (customer === 'Select Customer') {
                    alert('Please select a customer');
                    return;
                }
                
                if (item === 'Select Item') {
                    alert('Please select an item');
                    return;
                }
                
                if (!quantity || quantity < 1) {
                    alert('Please enter a valid quantity');
                    return;
                }
                
                alert('Order created successfully!');
                createOrderModal.classList.remove('active');
                resetOrderForm();
            });
            
            // Confirm delete
            confirmDeleteOrderBtn.addEventListener('click', () => {
                alert(`Order ${currentOrderId} deleted successfully!`);
                deleteOrderModal.classList.remove('active');
                currentOrderId = null;
            });
            
            // Close modals
            document.querySelectorAll('.modal-close, .close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    orderDetailsModal.classList.remove('active');
                    createOrderModal.classList.remove('active');
                    deleteOrderModal.classList.remove('active');
                    resetOrderForm();
                });
            });
            
            // Close modal when clicking outside
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                        resetOrderForm();
                    }
                });
            });
            
            // Reset order form function
            function resetOrderForm() {
                document.getElementById('orderCustomer').selectedIndex = 0;
                document.getElementById('orderItem').selectedIndex = 0;
                document.getElementById('orderQuantity').value = '1';
                document.getElementById('orderPrice').value = '';
                document.getElementById('orderDate').value = today;
                document.getElementById('orderDescription').value = '';
                document.getElementById('orderStatus').selectedIndex = 0;
                currentOrderId = null;
            }
            
            // Set active navigation link
            @* const currentPage = window.location.pathname.split('/').pop();
            document.querySelectorAll('.nav-link').forEach(link => {
                if (link.getAttribute('href') === currentPage) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            }); *@
            
            // Search functionality
            const orderSearch = document.getElementById('orderSearch');
            orderSearch.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const rows = document.querySelectorAll('tbody tr');
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            });
            
            // Auto-hide status update containers when clicking elsewhere
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.update-status-btn') && !e.target.closest('.status-update-container')) {
                    document.querySelectorAll('.status-update-container').forEach(container => {
                        container.classList.remove('active');
                    });
                }
            });
        });
    </script>